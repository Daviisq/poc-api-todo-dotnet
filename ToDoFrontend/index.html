<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>To-Do POC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body class="p-4">
  <div class="container">
    <h1>To-Do POC</h1>
    <form id="form" class="mb-3">
      <input id="title" class="form-control" placeholder="Nova tarefa" required />
      <button class="btn btn-primary mt-2">Adicionar</button>
    </form>

    <ul id="list" class="list-group"></ul>
  </div>
  
<script>
const apiBase = "https://localhost:5008s"; //!!!!!!

async function fetchTodos(){
  const res = await fetch(`${apiBase}/todos`);
  const todos = await res.json();
  const list = document.getElementById('list');
  list.innerHTML = '';
  todos.forEach(t => {
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML = `<span>${t.title} ${t.isCompleted ? '✔️' : ''}</span>
      <div>
        <button class="btn btn-sm btn-success me-1" onclick="toggle(${t.id},${t.isCompleted})">Toggle</button>
        <button class="btn btn-sm btn-danger" onclick="del(${t.id})">Delete</button>
      </div>`;
    list.appendChild(li);
  });
}

document.getElementById('form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const title = document.getElementById('title').value;
  await fetch(`${apiBase}/todos`, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ title })
  });
  document.getElementById('title').value = '';
  fetchTodos();
});

async function toggle(id, isCompleted){
  const res = await fetch(`${apiBase}/todos/${id}`);
  const todo = await res.json();
  todo.isCompleted = !isCompleted;
  await fetch(`${apiBase}/todos/${id}`, {
    method: 'PUT',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(todo)
  });
  fetchTodos();
}

async function del(id){
  await fetch(`${apiBase}/todos/${id}`, { method: 'DELETE' });
  fetchTodos();
}

fetchTodos();
</script>
</body>
</html>
